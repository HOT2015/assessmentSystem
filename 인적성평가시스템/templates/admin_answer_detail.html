{% extends "base.html" %}

{% block title %}지원자 답안 상세 - 인적성 평가시스템{% endblock %}

{% block page_id %}
<div class="page-id" style="background:#f8f9fa; border-bottom:1px solid #dee2e6; padding:4px 12px; font-size:0.95em; color:#888;">
  화면ID: PAGE-ANSWER-DETAIL (admin_answer_detail.html)
</div>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- 지원자 정보 카드 -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="card-title"><i class="fas fa-user"></i> 지원자 정보</h5>
                    <p class="mb-0">
                        <strong>이름:</strong> {{ candidate.name }}<br>
                        <strong>이메일:</strong> {{ candidate.email }}<br>
                        <strong>핸드폰번호:</strong> {{ candidate.phone }}
                    </p>
                </div>
                <div class="col-md-6">
                    <h5 class="card-title"><i class="fas fa-chart-bar"></i> 평가 결과</h5>
                    <p class="mb-0">
                        <strong>평가일시:</strong> {{ result.test_date[:19] if result.test_date else '' }}<br>
                        <strong>기술 점수:</strong> <span class="badge bg-primary">{{ result.scores.technical }}점</span><br>
                        <strong>문제해결력:</strong> <span class="badge bg-warning text-dark">{{ result.scores.problem_solving }}점</span><br>
                        <strong>총점:</strong> <span class="badge bg-success">{{ result.total_score }}점</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 기술 평가 섹션 -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="fas fa-code"></i> 기술 평가 답안</h4>
        </div>
        <div class="card-body">
            {% set technical_answers = [] %}
            {% for item in answers %}
                {% if item.question.category in ['Java', 'Database'] %}
                    {% set _ = technical_answers.append(item) %}
                {% endif %}
            {% endfor %}
            
            {% if technical_answers %}
                {% for item in technical_answers %}
                <div class="question-card mb-4 p-3 border rounded" id="question_{{ item.question.id }}">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="mb-0">
                            <span class="badge bg-primary me-2">{{ loop.index }}</span>
                            {{ item.question.question }}
                        </h5>
                        <div>
                            <span class="badge bg-secondary me-1">{{ item.question.category }}</span>
                            <span class="badge bg-info me-1">{{ item.question.difficulty }}</span>
                            <span class="badge bg-warning">{{ item.question.points }}점</span>
                        </div>
                    </div>
                    
                    {% if item.question.type == "객관식" %}
                    <div class="options-container">
                        {% for option in item.question.options %}
                        <div class="option-item p-2 border rounded mb-2 {% if option == item.answer %}selected-answer{% endif %} {% if option == item.question.correct_answer %}correct-answer{% endif %} {% if not item.answered %}unanswered{% endif %}">
                            <strong>{{ loop.index }}.</strong> {{ option }}
                            {% if option == item.answer %}
                                <span class="badge bg-primary ms-2">지원자 답변</span>
                            {% endif %}
                            {% if option == item.question.correct_answer %}
                                <span class="badge bg-success ms-2">정답</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                        {% if not item.answered %}
                        <div class="mt-2">
                            <span class="badge bg-secondary fs-6"><i class="fas fa-minus"></i> 미답변</span>
                        </div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">지원자 답변:</label>
                        {% if item.answered %}
                        <div class="p-3 bg-light border rounded">
                            <pre class="mb-0">{{ item.answer or '(답변 없음)' }}</pre>
                        </div>
                        {% else %}
                        <div class="p-3 bg-light border rounded unanswered">
                            <pre class="mb-0 text-muted">(미답변)</pre>
                        </div>
                        {% endif %}
                        <div class="mt-2">
                            <label class="form-label fw-bold">정답:</label>
                            <div class="p-2 bg-success bg-opacity-10 border border-success rounded">
                                <pre class="mb-0">{{ item.question.correct_answer }}</pre>
                            </div>
                            {% if item.question.keywords %}
                            <small class="text-muted">
                                <i class="fas fa-key"></i> 키워드: {{ item.question.keywords|join(', ') }}
                            </small>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="mt-3">
                        {% if not item.answered %}
                            <span class="badge bg-secondary fs-6"><i class="fas fa-minus"></i> 미답변</span>
                        {% elif item.is_correct %}
                            <span class="badge bg-success fs-6"><i class="fas fa-check"></i> 정답</span>
                        {% else %}
                            <span class="badge bg-danger fs-6"><i class="fas fa-times"></i> 오답</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">기술 평가 답안이 없습니다.</p>
            {% endif %}
        </div>
    </div>

    <!-- 문제해결력 평가 섹션 -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h4 class="mb-0"><i class="fas fa-lightbulb"></i> 문제해결력 평가 답안</h4>
        </div>
        <div class="card-body">
            {% set problem_solving_answers = [] %}
            {% for item in answers %}
                {% if item.question.category == '문제해결' %}
                    {% set _ = problem_solving_answers.append(item) %}
                {% endif %}
            {% endfor %}
            
            {% if problem_solving_answers %}
                {% for item in problem_solving_answers %}
                <div class="question-card mb-4 p-3 border rounded" id="question_{{ item.question.id }}">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="mb-0">
                            <span class="badge bg-warning me-2">{{ loop.index }}</span>
                            {{ item.question.question }}
                        </h5>
                        <div>
                            <span class="badge bg-secondary me-1">{{ item.question.category }}</span>
                            <span class="badge bg-info me-1">{{ item.question.difficulty }}</span>
                            <span class="badge bg-warning">{{ item.question.points }}점</span>
                        </div>
                    </div>
                    
                    <div class="options-container">
                        {% for option in item.question.options %}
                        <div class="option-item p-2 border rounded mb-2 {% if option == item.answer %}selected-answer{% endif %} {% if option == item.question.correct_answer %}correct-answer{% endif %} {% if not item.answered %}unanswered{% endif %}">
                            <strong>{{ loop.index }}.</strong> {{ option }}
                            {% if option == item.answer %}
                                <span class="badge bg-primary ms-2">지원자 답변</span>
                            {% endif %}
                            {% if option == item.question.correct_answer %}
                                <span class="badge bg-success ms-2">정답</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                        {% if not item.answered %}
                        <div class="mt-2">
                            <span class="badge bg-secondary fs-6"><i class="fas fa-minus"></i> 미답변</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="mt-3">
                        {% if not item.answered %}
                            <span class="badge bg-secondary fs-6"><i class="fas fa-minus"></i> 미답변</span>
                        {% elif item.is_correct %}
                            <span class="badge bg-success fs-6"><i class="fas fa-check"></i> 정답</span>
                        {% else %}
                            <span class="badge bg-danger fs-6"><i class="fas fa-times"></i> 오답</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">문제해결력 평가 답안이 없습니다.</p>
            {% endif %}
        </div>
    </div>

    <!-- 요약 정보 -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-chart-pie"></i> 답안 요약</h5>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-2">
                    <h4 class="text-primary">{{ answers|length }}</h4>
                    <small class="text-muted">총 문제 수</small>
                </div>
                <div class="col-md-2">
                    <h4 class="text-info">{{ answers|selectattr('answered')|list|length }}</h4>
                    <small class="text-muted">답변한 문제</small>
                </div>
                <div class="col-md-2">
                    <h4 class="text-secondary">{{ answers|rejectattr('answered')|list|length }}</h4>
                    <small class="text-muted">미답변 문제</small>
                </div>
                <div class="col-md-2">
                    <h4 class="text-success">{{ answers|selectattr('is_correct')|list|length }}</h4>
                    <small class="text-muted">정답 수</small>
                </div>
                <div class="col-md-2">
                    <h4 class="text-danger">{{ answers|selectattr('answered')|rejectattr('is_correct')|list|length }}</h4>
                    <small class="text-muted">오답 수</small>
                </div>
                <div class="col-md-2">
                    {% set answered_count = answers|selectattr('answered')|list|length %}
                    {% set correct_count = answers|selectattr('is_correct')|list|length %}
                    <h4 class="text-warning">{{ "%.1f"|format((correct_count / answered_count * 100) if answered_count > 0 else 0) }}%</h4>
                    <small class="text-muted">정답률</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 버튼 -->
    <div class="text-center">
        <a href="{{ url_for('admin') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> 관리자 페이지로 돌아가기
        </a>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print"></i> 답안 출력
        </button>
    </div>
</div>

<style>
.question-card {
    background-color: #f8f9fa;
    transition: all 0.3s ease;
}

.question-card:hover {
    background-color: #e9ecef;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.option-item {
    cursor: default;
    transition: all 0.2s ease;
}

.option-item:hover {
    background-color: #f8f9fa;
}

.selected-answer {
    background-color: #007bff !important;
    color: white !important;
    border-color: #007bff !important;
}

.correct-answer {
    background-color: #28a745 !important;
    color: white !important;
    border-color: #28a745 !important;
}

.selected-answer.correct-answer {
    background-color: #28a745 !important;
    border-color: #28a745 !important;
}

.unanswered {
    opacity: 0.6;
    background-color: #f8f9fa !important;
    color: #6c757d !important;
    border-color: #dee2e6 !important;
}

.unanswered .option-item {
    opacity: 0.7;
}

pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}

@media print {
    .btn {
        display: none !important;
    }
    
    .card {
        border: 1px solid #000 !important;
        break-inside: avoid;
    }
    
    .question-card {
        break-inside: avoid;
        page-break-inside: avoid;
    }
}
</style>
{% endblock %} 